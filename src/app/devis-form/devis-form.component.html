<div *ngIf="loading" class="skeleton-container">
  <!-- Skeleton loader for form fields -->
  <div class="skeleton skeleton-title"></div>
  <div class="skeleton skeleton-form-group"></div>
  <div class="skeleton skeleton-form-group"></div>
  <div class="skeleton skeleton-form-group"></div>
  <div class="skeleton skeleton-form-group"></div>

  <!-- Skeleton loader for fouta items -->
  <div *ngFor="let item of [1, 2, 3]" class="skeleton-fouta-item">
    <div class="skeleton skeleton-image"></div>
    <div class="skeleton skeleton-text"></div>
    <div class="skeleton skeleton-details"></div>
  </div>

</div>

<form (ngSubmit)="submitDevis()" #devisForm="ngForm" *ngIf="!loading" class="devis-form">


  <div style="text-align: center;">
    <h2>Demandez un devis</h2>
    <img src="../../assets/icon-accmod.png" loading="lazy" style="margin-bottom: 2rem;">
  </div>

  <div class="form-container">
    <div class="user-info">
      <!-- Name -->
      <div class="form-group">
        <label for="name">Nom:</label>
        <input id="name" type="text" [(ngModel)]="name" name="name" required #nameField="ngModel">
        <div *ngIf="nameField.invalid && nameField.touched" class="error-message">
          Le nom est obligatoire.
        </div>
      </div>

      <!-- Prenom -->
      <div class="form-group">
        <label for="prenom">Prénom:</label>
        <input id="prenom" type="text" [(ngModel)]="prenom" name="prenom" required #prenomField="ngModel">
        <div *ngIf="prenomField.invalid && prenomField.touched" class="error-message">
          Le prénom est obligatoire.
        </div>
      </div>

      <!-- Phone Number -->
      <div class="form-group">
        <label for="numtel">Téléphone:</label>
        <input id="numtel" type="text" [(ngModel)]="numtel" name="numtel" required minlength="8" #numtelField="ngModel">
        <div *ngIf="numtelField.invalid && numtelField.touched" class="error-message">
          Numéro de téléphone invalide (minimum 8 caractères).
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">Email:</label>
        <input id="email" type="email" [(ngModel)]="email" name="email" required email #emailField="ngModel">
        <div *ngIf="emailField.invalid && emailField.touched" class="error-message">
          Email invalide.
        </div>
      </div>

      <!-- Comments -->
      <div class="form-group">
        <label for="comments">Commentaires:</label>
        <textarea id="comments" [(ngModel)]="comments" name="comments" rows="2"></textarea>
      </div>
    </div>

    <!-- Fouta Selection -->
    <div class="fouta-selection-container">
      <div *ngIf="devisService.devisItems.length === 0" class="no-products-message">
        <p>Aucun produit n'a été ajouté. Veuillez sélectionner des produits avant de demander un devis.</p>
      </div>

      <div class="fouta-list">
        <div class="fouta-item" *ngFor="let item of devisService.devisItems; let i = index">
          <div class="fouta-image-row">
            <img [src]="item.image" alt="{{ item.name }}" class="fouta-image">
            <h3 class="fouta-title">{{ item.name }}</h3>
          </div>

          <div class="fouta-details-row">
            <div class="form-group">
              <label for="dimension{{i}}">Choisissez une dimension:</label>
              <select id="dimension{{i}}" [(ngModel)]="item.selectedDimension" name="dimension{{i}}" required #dimensionField="ngModel">
                <option *ngFor="let dimension of item.dimensions" [value]="dimension">{{ dimension }}</option>
              </select>
              <div *ngIf="dimensionField.invalid && dimensionField.touched" class="error-message">
                Veuillez sélectionner une dimension.
              </div>
            </div>

            <div class="form-group">
              <label for="quantity{{i}}">Quantité:</label>
              <input id="quantity{{i}}" type="number" [(ngModel)]="item.quantity" name="quantity{{i}}" min="35" required #quantityField="ngModel">
              <div *ngIf="quantityField.invalid && quantityField.touched" class="error-message">
                La quantité minimale est de 35.
              </div>
            </div>

            <i class="pi pi-trash" style="font-size: 1.5rem; color: tomato;" (click)="deleteFouta(i)"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- [disabled]="devisForm.invalid || devisService.devisItems.length === 0 || isSubmitting" -->
  <button type="submit" class="btn-submit" >
    <span *ngIf="!isSubmitting">Soumettre le devis</span>
    <span *ngIf="isSubmitting">Envoi en cours...</span> <!-- Indicateur de chargement -->
  </button>

</form>
